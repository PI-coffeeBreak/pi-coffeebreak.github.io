---
layout: ../layouts/MarkdownLayout.astro
title: Getting Started
---

# Getting Started

This guide will help you set up the development environment for the CoffeeBreak project.

## 1. Clone the main repositories

```bash
# Clone the core repository
$ git clone https://github.com/PI-coffeeBreak/core.git

# Clone the event-app repository
$ git clone https://github.com/PI-coffeeBreak/event-app.git

# Clone the frontend repository
$ git clone https://github.com/PI-coffeeBreak/frontend.git

# (Optional) Clone the webpush-sender service
# Only required if you want to use the webpush-notifications plugin
$ git clone https://github.com/PI-coffeeBreak/webpush-sender.git
```

> **Note:** The `webpush-sender` service is only required if you want to use the `webpush-notifications` plugin. If you do not plan to use push notifications, you can skip this step.

## 2. Example `docker-compose.yml` (development)

<div class="flex gap-4 mb-4">
  <a href="/docker-compose.dev.yml" class="btn btn-primary no-underline text-white font-semibold" download="docker-compose.dev.yml">Download development docker-compose.yml</a>
  <a href="/docker-compose.prod.yml" class="btn btn-secondary no-underline text-white font-semibold" download="docker-compose.prod.yml">Download production docker-compose.yml</a>
</div>

Below is a development example. For production, use the downloadable file above.

```yaml
services:
  core:
    # image: ghcr.io/pi-coffeebreak/core:latest
    build:
      context: ./core
      dockerfile: Dockerfile
    environment:
      - KEYCLOAK_URL=${KEYCLOAK_URL}
      - KEYCLOAK_CLIENT_SECRET=${KEYCLOAK_CLIENT_SECRET}
      - DATABASE_URI=${DATABASE_URI}
      - MONGODB_URI=${MONGODB_URI}
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_DEFAULT_USER}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS}
    depends_on:
      - database
      - keycloak
      - mongodb

  event-app:
    # image: ghcr.io/pi-coffeebreak/event-app:latest
    build:
      context: ./event-app
      dockerfile: Dockerfile
    environment:
      - VITE_API_BASE_URL=${VITE_API_BASE_URL}
      - VITE_WS_URL=${VITE_WS_URL}
      - VITE_VAPID_PUBLIC_KEY=${VITE_VAPID_PUBLIC_KEY}

  frontend:
    # image: ghcr.io/pi-coffeebreak/admin-frontend:latest
    build:
      context: ./frontend
      dockerfile: Dockerfile
    environment:
      - VITE_API_BASE_URL=${VITE_API_BASE_URL}
      - VITE_KEYCLOAK_URL=${VITE_KEYCLOAK_URL}
      - VITE_KEYCLOAK_CLIENT_ID=coffeebreak-client

  database:
    image: postgres:17.4-alpine3.21
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    ports:
      - "5432:5432" # Remove in production

  mongodb:
    image: mongo:8.0.5
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
    ports:
      - "27017:27017" # Remove in production

  keycloak:
    build:
      context: ./keycloak
    environment:
      - KEYCLOAK_ADMIN=${KEYCLOAK_ADMIN}
      - KEYCLOAK_ADMIN_PASSWORD=${KEYCLOAK_ADMIN_PASSWORD}
      - KC_DB_USERNAME=${KC_DB_USERNAME}
      - KC_DB_PASSWORD=${KC_DB_PASSWORD}
    depends_on:
      - keycloak-db
    ports:
      - "8081:8080" # Remove in production

  keycloak-db:
    image: postgres:17.4-alpine3.21
    environment:
      - POSTGRES_DB=keycloak
      - POSTGRES_USER=${KC_DB_USERNAME}
      - POSTGRES_PASSWORD=${KC_DB_PASSWORD}
    ports:
      - "5433:5432" # Remove in production

  mq:
    image: rabbitmq:4.0.8-management-alpine
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_DEFAULT_USER}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS}
    ports:
      - "5672:5672" # Remove in production

  nginx:
    image: nginx:1.27.4-alpine3.21-perl
    ports:
      - "80:80" # Remove in production
      - "443:443" # Remove in production
    depends_on:
      - core
      - event-app
      - frontend

  # webpush-sender service (optional, only needed if using webpush-notifications plugin)
  # webpush-sender:
  #   build:
  #     context: ./webpush-sender
  #     dockerfile: Dockerfile
  #   environment:
  #     - VAPID_PUBLIC_KEY=${VAPID_PUBLIC_KEY}
  #     - VAPID_PRIVATE_KEY=${VAPID_PRIVATE_KEY}
  #     - RABBITMQ_URL=${RABBITMQ_URL:-amqp://mq:5672}
  #     - POSTGRES_USER=${POSTGRES_USER}
  #     - POSTGRES_HOST=database
  #     - POSTGRES_DB=coffeebreak
  #     - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
  #   depends_on:
  #     - mq
```

## 3. Example `.env`

<a href="/.env.example" class="btn btn-primary no-underline text-white font-semibold mb-4" download=".env.example">Download .env.example</a>

Adjust the values as needed. Use generic secrets and remember to change the values marked with `# change me`.

```env
# PostgreSQL
POSTGRES_USER=username
POSTGRES_PASSWORD=password                  # change me
POSTGRES_HOST=database
POSTGRES_PORT=5432
POSTGRES_DB=coffeebreak

# MongoDB
MONGO_INITDB_ROOT_USERNAME=admin
MONGO_INITDB_ROOT_PASSWORD=admin            # change me
MONGO_INITDB_DATABASE=coffeebreak

# Keycloak
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin               # change me
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=keycloak                     # change me
KEYCLOAK_URL=http://localhost/auth/         # change to your real hostname in production
KEYCLOAK_CLIENT_SECRET=your-keycloak-client-secret # change me

# RabbitMQ
RABBITMQ_DEFAULT_USER=username
RABBITMQ_DEFAULT_PASS=password              # change me

# Web Push VAPID Keys
VAPID_PUBLIC_KEY=your-vapid-public-key      # change me
VAPID_PRIVATE_KEY=your-vapid-private-key    # change me

# Frontend
VITE_API_BASE_URL=http://localhost/api/v1   # change to your real hostname in production
VITE_WS_URL=ws://localhost/ws               # change to your real hostname in production
VITE_KEYCLOAK_URL=http://localhost/auth     # change to your real hostname in production
VITE_VAPID_PUBLIC_KEY=your-vapid-public-key # change me

# Environment
ENVIRONMENT=development                     # change to 'production' in production
```

## 4. How to generate VAPID keys

For push notifications, you need a pair of VAPID keys. Generate them with the following command (requires Node.js):

```bash
npx web-push generate-vapid-keys
```

The command will generate two keys:
- `publicKey`: use as `VAPID_PUBLIC_KEY`
- `privateKey`: use as `VAPID_PRIVATE_KEY`

## 5. How to get the `KEYCLOAK_CLIENT_SECRET`

1. Access the Keycloak panel (usually at `http://localhost/auth`).
2. Log in as administrator.
3. In the side menu, select the `coffeebreak` realm.
4. Go to **Clients** and select the `fastapi-client` client.
5. Click on **Credentials**.
6. Copy the **Secret** value and set it in your `.env` as `KEYCLOAK_CLIENT_SECRET`.

## 6. Example nginx configuration for production

<a href="/nginx.conf" class="btn btn-primary no-underline text-white font-semibold" download="nginx.conf">Download example nginx.conf</a>

Below is an example of an `nginx.conf` for production, similar to the one used in orchestrator. 

> **Note:** Change the `server_name _;` line to match your domain, e.g. `server_name mydomain.com;`

```nginx
# Example nginx.conf for CoffeeBreak
# Change 'server_name _;' to your actual domain, e.g. 'server_name mydomain.com;'
events {
    worker_connections 1024;
    use epoll;
}

http {
    map $http_upgrade $connection_upgrade {
        default upgrade;
        ''      close;
    }

    upstream keycloak {
        server keycloak:8443;
    }

    upstream api-application {
        server api-application:8080;
    }

    upstream event-app {
        server event-app:80;
    }

    upstream frontend {
        server frontend:80;
    }

    server {
        listen 80;
        server_name _; # Change this to your domain

        location /auth/ {
            proxy_pass https://keycloak/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_verify off;
        }

        location /api/v1/ {
            proxy_pass http://api-application;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /ws {
            proxy_pass http://api-application;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header Origin $scheme://$host;
        }

        location / {
            proxy_pass http://event-app;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    server {
        listen 80;
        server_name _; # Change this to your admin domain if needed

        location / {
            proxy_pass http://frontend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

---

If you have any questions, check the repositories' documentation or contact the team.
